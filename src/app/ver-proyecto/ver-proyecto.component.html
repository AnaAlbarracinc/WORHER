<app-cargando *ngIf="isCargando()"></app-cargando>
<ng-container *ngIf="!isCargando()">
    <div class="container-fluid" *ngIf="!isChat()">
        <div class="cabecera row">
            <h1 class="col-12 col-md">{{proyecto.nombre}}</h1>
            <div class="miembros col">
                <app-usuario class="miembro" [usuario]="m" *ngFor="let m of get3Miembros()"></app-usuario>
                <div class="miembro" *ngIf="proyecto.usuarios.length>3">
                    <div class="circulo col">+{{proyecto.usuarios.length - 3}}</div>
                </div>

                <div class="nombres">
                    <ul>
                        <li *ngFor="let u of proyecto.usuarios">{{u.nombre}} {{u.apellido}}</li>
                    </ul>
                </div>
            </div>
        </div>


        <div class="botones row">
            <button class="btn boton col-12" data-bs-toggle="modal" data-bs-target="#moverTarea">Mover tarea</button>
            <button class="btn boton col-12" data-bs-toggle="modal" data-bs-target="#exampleModal">Editar tarea</button>
            <button class="btn boton col-12">Crear tarea</button>
            <button class="btn boton botonChat col-12" (click)="mostrarChat()">Chat</button>
            <button *ngIf="!filtrando" class="btn boton col-12" (click)="filtrar()">Filtro</button>
            <button *ngIf="filtrando" class="btn boton col-12" (click)="filtrar()"><svg xmlns="http://www.w3.org/2000/svg"
                    width="20" height="20" fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16">
                    <path fill-rule="evenodd"
                        d="M13.854 2.146a.5.5 0 0 1 0 .708l-11 11a.5.5 0 0 1-.708-.708l11-11a.5.5 0 0 1 .708 0Z" />
                    <path fill-rule="evenodd"
                        d="M2.146 2.146a.5.5 0 0 0 0 .708l11 11a.5.5 0 0 0 .708-.708l-11-11a.5.5 0 0 0-.708 0Z" />
                </svg>
            </button>
        </div>
           
        <div class="filtro" *ngIf="filtrando">
            <div class="form-check form-check-inline">
                <label class="form-check-label" for="prioridad_baja">Prioridad baja</label>
                <input class="form-check-input" type="checkbox" id="prioridad_baja" checked value="1">
            </div>
            <div class="form-check form-check-inline">
                <label class="form-check-label" for="prioridad_media">Prioridad media</label>
                <input class="form-check-input" type="checkbox" id="prioridad_media" checked value="2">
            </div>
            <div class="form-check form-check-inline">
                <label class="form-check-label" for="prioridad_alta">Prioridad alta</label>
                <input class="form-check-input" type="checkbox" id="prioridad_alta" checked value="3">
            </div>
        </div>
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-9 container">
                    <div class="listas row">

                        <app-lista (actualizar)="isActualizar($event)" class="col-sm-12 col-md-6 col-lg-4 mt-2" [proyecto]="proyecto" [lista]="lista"
                            *ngFor="let lista of proyecto.listas"  ></app-lista>
                        
                        <div class="col-sm-12 col-md-6 col-lg-4 mt-2">
                            
                            <div  class="mt-2 lista ">
                                <h3>Nueva lista</h3>
                                <div class="txt_field form-control mt-4">
                                    <input type="text" required aria-label="Introducir nombre de nueva lista"
                                        name="nombreNuevaLista" #nombreNuevaLista id="nombreNuevaLista">
                                    <span class="span"></span>
                                    <label for="nombreNuevaLista" class="control-label required">Nombre de lista</label>
                                </div>
                                <h4>Añadir lista</h4>
                                <div class="botonAdd">
                                    <svg (click)="addLista(nombreNuevaLista.value); nombreNuevaLista.value=''"
                                        role="button" class="btn" xmlns="http://www.w3.org/2000/svg" width="30"
                                        height="30" fill="currentColor" class="bi bi-plus-lg" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd"
                                            d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2Z" />
                                    </svg>
                                </div>

                            </div>
                        </div>

                    </div>
                </div>
                <app-chat [proyecto]="proyecto" class="col-lg-3  chat"></app-chat>
            </div>
        </div>
    </div>

    <div class="container-fluid mostrarChat" *ngIf="isChat()">
        <div class="botones">
            <button class="btn boton" (click)="noMostrarChat()">Volver al proyecto</button>
        </div>
        <app-chat [proyecto]="proyecto"></app-chat>
    </div>
</ng-container>

<!-- -------------------------MODALES--------------------------- -->

<!-- -------------------------MOVER TAREA ------------------------ -->
<div class="modal fade" id="moverTarea" tabindex="-1" aria-labelledby="moverTareaLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="moverTareaLabel">Mover tarea</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        
        <div class="modal-body">
          <form class="form-group">
            <label for="original">¿En qué lista se encuentra la tarea?</label>
            <select name="original" id="original" class="form-select" #original (change)="getTareasLista(original.value, tareaId, nuevaListaId, boton)">
                <option value="-1">Selecciona una lista</option>
                <option *ngFor="let l of getListas()" value="{{l.id}}">{{l.nombre}}</option>
            </select>
            <label for="tareaId">¿Qué tarea quiere mover?</label>
            <select name="tareaId" id="tareaid" class="form-select" #tareaId disabled (change)="habilitarResto(tareaId.value, nuevaListaId, boton)">
                <option value="-1" >Selecciona una tarea</option>
                <option *ngFor="let t of tareas" value="{{t.id}}">{{t.nombre}}</option>
            </select>
            <label for="nuevaListaId">¿A qué lista quiere mover la tarea?</label>
            <select name="nuevaListaId" id="nuevaListaId" class="form-select" #nuevaListaId disabled (change)="habilitarBoton(nuevaListaId.value, original.value, boton)">
                <option value="-1">Selecciona una lista</option>
                <option *ngFor="let r of getListas()" value="{{r.id}}">{{r.nombre}}</option>
            </select>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" #boton  (click)="moverTarea(tareaId.value, nuevaListaId.value, original.value)" disabled class="btn boton" data-bs-dismiss="modal">Mover tarea</button>
        </div>
      </div>
    </div>
  </div>


  <!-- -------------------MODAL EDITAR TAREA-------------------- -->
  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          ...
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Save changes</button>
        </div>
      </div>
    </div>
  </div>